# –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Style Transfer (–∑–∞–º–µ–Ω–∏—Ç—å –≤ bot.py –Ω–∞—á–∏–Ω–∞—è —Å –ª–∏–Ω–∏–∏ ~1070)

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è Style Transfer —Å Imagen
        if st_state["step"] == "prompt":
            text = update.message.text.strip()
            prompt = text if text and text != "-" else ""

            # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
            if prompt:
                await update.message.reply_text("‚è≥ –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞...")
                prompt = translate_to_english(prompt, "gpt-4o")

            # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Imagen
            await update.message.reply_text(
                "üçåüíé <b>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª—è —á–µ—Ä–µ–∑ Nano Banana Pro...</b>\n\n"
                "–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥...",
                parse_mode="HTML"
            )

            try:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º Nano Banana Pro –¥–ª—è style transfer
                result = apply_style_transfer_imagen(
                    init_image=st_state["init_image"],
                    style_image=st_state["style_image"],
                    prompt=prompt,
                    aspect_ratio="1:1"
                )

                if result and len(result) > 0:
                    # –£—Å–ø–µ—Ö - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å watermark
                    result[0].seek(0)
                    watermarked_image = add_watermark(result[0])
                    await context.bot.send_photo(uid, watermarked_image)
                    await context.bot.send_message(
                        uid,
                        "‚úÖ <b>Style Transfer –∑–∞–≤–µ—Ä—à–µ–Ω!</b>\n\n"
                        "üçåüíé –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Nano Banana Pro (Google Imagen 3)",
                        parse_mode="HTML"
                    )
                else:
                    await update.message.reply_text("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å")

            except Exception as e:
                error_msg = str(e)
                print(f"[Style Transfer Error] {error_msg}")
                await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {error_msg}")

            # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            user_state[uid]["style_transfer"] = {"active": False}
            return


# –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Style Guide (–Ω–∞–π—Ç–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –±–ª–æ–∫ –∏ –∑–∞–º–µ–Ω–∏—Ç—å)

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è Style Guide —Å Imagen
        if sg_state["step"] == "prompt":
            text = update.message.text.strip()

            if not text or text == "-":
                await update.message.reply_text("‚ùå –ü—Ä–æ–º–ø—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è Style Guide")
                return

            prompt = text

            # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
            await update.message.reply_text("‚è≥ –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞...")
            prompt = translate_to_english(prompt, "gpt-4o")

            # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Imagen
            await update.message.reply_text(
                "üçåüíé <b>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∏–ª—é —á–µ—Ä–µ–∑ Nano Banana Pro...</b>\n\n"
                "–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥...",
                parse_mode="HTML"
            )

            try:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º Nano Banana Pro –¥–ª—è style guide
                result = generate_with_style_guide_imagen(
                    style_image=sg_state["style_image"],
                    prompt=prompt,
                    aspect_ratio="1:1"
                )

                if result and len(result) > 0:
                    # –£—Å–ø–µ—Ö - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å watermark
                    result[0].seek(0)
                    watermarked_image = add_watermark(result[0])
                    await context.bot.send_photo(uid, watermarked_image)
                    await context.bot.send_message(
                        uid,
                        "‚úÖ <b>Style Guide –∑–∞–≤–µ—Ä—à–µ–Ω!</b>\n\n"
                        "üçåüíé –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Nano Banana Pro (Google Imagen 3)",
                        parse_mode="HTML"
                    )
                else:
                    await update.message.reply_text("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ")

            except Exception as e:
                error_msg = str(e)
                print(f"[Style Guide Error] {error_msg}")
                await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {error_msg}")

            # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            user_state[uid]["style_guide"] = {"active": False}
            return
