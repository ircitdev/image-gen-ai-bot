# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Imagen 3 Customization –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ `imagen3_custom_api.py` - API –º–æ–¥—É–ª—å
- ‚úÖ `imagen3_custom_helper.py` - Helper –¥–ª—è –±–æ—Ç–∞
- ‚úÖ `keyboards.py` - –æ–±–Ω–æ–≤–ª—ë–Ω (–¥–æ–±–∞–≤–ª–µ–Ω—ã `subject_type_kb`, `reference_upload_kb`)

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ bot.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∞ 56, 62)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è –≤ `image_engine_kb()` (keyboards.py:14)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `engine_imagen3_custom` (—Å—Ç—Ä–æ–∫–∞ ~1827)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Å—É–±—ä–µ–∫—Ç–∞ `subject_*` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 1860)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ `ref_clear`, `ref_done`
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º–∞—Ç–∞ `imgfmt_*` –¥–ª—è Imagen 3 Custom
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (—Å—Ç—Ä–æ–∫–∞ ~878)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è Imagen 3 Custom (—Å—Ç—Ä–æ–∫–∞ ~1696)

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∏–ª–∏ —Ç–µ–∫—Å—Ç –±–æ—Ç—É
2. –í—ã–±—Ä–∞—Ç—å "üë§ Imagen 3 Custom (—Å —Ñ–æ—Ç–æ)"
3. –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Å—É–±—ä–µ–∫—Ç–∞ (–ß–µ–ª–æ–≤–µ–∫/–ñ–∏–≤–æ—Ç–Ω–æ–µ/–ü—Ä–æ–¥—É–∫—Ç/–î—Ä—É–≥–æ–µ)
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å 1-4 —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö —Ñ–æ—Ç–æ
5. –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: "standing on a beach")
6. –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç (1:1, 16:9 –∏ —Ç.–¥.)
7. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç!

### –ü—Ä–∏–º–µ—Ä:
**–†–µ—Ñ–µ—Ä–µ–Ω—Å:** –§–æ—Ç–æ —á–µ–ª–æ–≤–µ–∫–∞
**–ü—Ä–æ–º–ø—Ç:** "wearing a spacesuit on Mars"
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ß–µ–ª–æ–≤–µ–∫ —Å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ —Ñ–æ—Ç–æ –≤ —Å–∫–∞—Ñ–∞–Ω–¥—Ä–µ –Ω–∞ –ú–∞—Ä—Å–µ üöÄ

## –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
scp imagen3_custom_api.py root@31.44.7.144:/root/bots/usp/
scp imagen3_custom_helper.py root@31.44.7.144:/root/bots/usp/

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
scp keyboards.py root@31.44.7.144:/root/bots/usp/
scp bot.py root@31.44.7.144:/root/bots/usp/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
ssh root@31.44.7.144 'cd /root/bots/usp && pkill -9 -f "python3 bot.py" && rm -f /tmp/imagegen_bot.lock && sleep 3 && nohup python3 bot.py > bot.log 2>&1 &'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
ssh root@31.44.7.144 'sleep 5 && tail -30 /root/bots/usp/bot.log'
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ù–∞–π—Ç–∏ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/new`
3. –í—ã–±—Ä–∞—Ç—å "üë§ Imagen 3 Custom (—Å —Ñ–æ—Ç–æ)"
4. –í—ã–±—Ä–∞—Ç—å "üë§ –ß–µ–ª–æ–≤–µ–∫"
5. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ª–∏—Ü–∞
6. –í–≤–µ—Å—Ç–∏: "as a superhero flying in the sky"
7. –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç: 16:9
8. –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞!

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ callback handlers:
- `engine_imagen3_custom` - –≤—ã–±–æ—Ä –¥–≤–∏–∂–∫–∞
- `subject_person`, `subject_animal`, `subject_product`, `subject_default` - —Ç–∏–ø —Å—É–±—ä–µ–∫—Ç–∞
- `ref_clear` - –æ—á–∏—Å—Ç–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã
- `ref_done` - –≥–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `imgfmt_*` - —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Imagen 3 Custom

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_state):
```python
{
    "engine": "imagen3_custom",
    "subject_type": "person",  # –∏–ª–∏ animal, product, default
    "reference_images": [BytesIO, BytesIO, ...],  # 1-4 —Ñ–æ—Ç–æ
    "prompt": "—Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞",
    "imagen_format": "1:1"
}
```

### API –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **Model:** imagen-3.0-capability-001
- **Timeout:** 180 —Å–µ–∫—É–Ω–¥
- **Max references:** 4 —Ñ–æ—Ç–æ
- **Formats:** 1:1, 3:4, 4:3, 9:16, 16:9

---

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–î–∞—Ç–∞:** 2026-02-22
**–í–µ—Ä—Å–∏—è:** 1.0
**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü–æ–ª–Ω–∞—è

–í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä!
